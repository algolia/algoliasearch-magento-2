<?php /** @var $this \Algolia\AlgoliaSearch\Block\Adminhtml\Analytics\Index */ ?>
<?php if (!$this->checkIsValidDateRange()): ?>
<div class="algoliasearch-notices message message-notice notice">
    <div class="notice">
        <?php echo __('The selected date is out of your analytics retention window (7 days), your data might not be present anymore.'); ?>
    </div>
</div>
<?php endif ?>
<div class="algoliasearch-analytics-overview">
    <div class="row section">
        <strong><?php echo __('Viewing index:'); ?></strong> <?php echo $this->getIndexName() ?>
    </div>
    <div class="row thirds clearfix section">
        <div class="one-third col-1">
            <div class="title">
                <h4><?php echo __('Total Searches') ?></h4>
            </div>
            <span class="stat"><?php echo $this->getTotalCountOfSearches() ?></span>
        </div>
        <div class="one-third col-2">
            <h4><?php echo __('Users') ?></h4>
            <span class="stat"><?php echo $this->getTotalUsersCount() ?></span>
        </div>
        <div class="one-third col-3">
            <h4><?php echo __('No Results Rate') ?></h4>
            <span class="stat"><?php echo $this->getTotalResultRates() ?></span>
        </div>
    </div>
    <div class="row clearfix section daily-search-section">
        <div class="title">
            <h3><?php echo __('Daily Searches') ?></h3>
            <div class="total-search"><?php echo __('Total Searches') ?> <span class="count"><?php echo $this->getTotalCountOfSearches() ?></span></div>
        </div>
        <?php echo $this->getDailyChart(); ?>
    </div>
    <div class="row thirds analytics-searches">
        <div class="one-third section popular-searches">
            <div class="title">
                <h3><?php echo __('Popular Searches') ?></h3>
            </div>
            <div class="analytics-content">
                <?php if (count($this->getTopSearches())): ?>
                    <table class="data-table admin__table-primary">
                        <thead>
                            <tr class="headings">
                                <th><?php echo __('Query') ?></th>
                                <th><?php echo __('Count') ?></th>
                            </tr>
                        </thead>
                        <tbody>
                        <?php foreach ($this->getTopSearches() as $search): ?>
                            <tr>
                                <td><?php echo $search['search'] ?></td>
                                <td><?php echo $search['count'] ?></td>
                            </tr>
                        <?php endforeach ?>
                        </tbody>
                    </table>
                <?php else: ?>
                    <?php echo __('No searches yet!'); ?>
                <?php endif ?>
            </div>
        </div>
        <div class="one-third section no-result-searches">
            <div class="title">
                <h3><?php echo __('Popular Results') ?></h3>
            </div>
            <div class="analytics-content">
                <?php if (count($this->getPopularResults())): ?>
                    <table class="data-table admin__table-primary">
                        <thead>
                        <tr class="headings">
                            <th><?php echo __('Results') ?></th>
                            <th class="a-right"><?php echo __('Impressions') ?></th>
                        </tr>
                        </thead>
                        <tbody>
                        <?php foreach ($this->getPopularResults() as $search): ?>
                            <tr>
                                <td>
                                    <?php if (isset($search['name'])): ?>
                                        <a href="<?php echo $this->getTypeEditUrl($search['hit']) ?>">
                                            <?php echo $search['name'] ?>
                                        </a>
                                    <?php else: ?>
                                        <?php echo $search['hit']; ?>
                                    <?php endif ?>
                                </td>
                                <td class="a-right"><?php echo $search['count'] ?></td>
                            </tr>
                        <?php endforeach ?>
                        </tbody>
                    </table>
                <?php else: ?>
                    <?php echo __('No results yet!'); ?>
                <?php endif ?>
            </div>
        </div>
        <div class="one-third section no-result-searches">
            <div class="title">
                <h3><?php echo __('No Result Searches') ?></h3>
            </div>
            <div class="analytics-content">
                <?php if (count($this->getNoResultSearches())): ?>
                    <table class="data-table admin__table-primary">
                        <thead>
                            <tr class="headings">
                                <th><?php echo __('Query') ?></th>
                                <th class="a-right"><?php echo __('Count') ?></th>
                            </tr>
                        </thead>
                        <tbody>
                        <?php foreach ($this->getNoResultSearches() as $search): ?>
                            <tr>
                                <td><?php echo $search['search'] ?></td>
                                <td class="a-right"><?php echo $search['count'] ?></td>
                            </tr>
                        <?php endforeach ?>
                        </tbody>
                    </table>
                <?php else: ?>
                    <?php echo __('No results yet!'); ?>
                <?php endif ?>
            </div>
        </div>
    </div>
</div>
